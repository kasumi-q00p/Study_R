<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7. グラフ作成の応用 - Rで学ぶ生物統計学とデータ可視化</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="nav-menu">
        <ul>
            <<li><a href="index.html">ホーム</a></li>
            <li><a href="1-introduction.html">1. はじめに</a></li>
            <li><a href="2-r-basics-content.html">2. R言語の基礎</a></li>
            <li><a href="3-bio-data-preprocessing.html">3. データ前処理</a></li>
            <li><a href="4-descriptive-statistics-combined.html">4. 記述統計学</a></li>
            <li><a href="5-basic-statistical.html">5. 基本的な統計検定</a></li>
            <li><a href="6-basic-graph.html">6. グラフ作成の基礎</a></li>
            <li><a href="7-advanced-graph-creation.html">7. グラフ作成の応用</a></li>
            <li><a href="8-advanced-data-visualization.html">8. 応用データの可視化</a></li>
            <li><a href="9-practical-project-examples.html">9. 実践的なプロジェクト例</a></li>
            <li><a href="10-advanced-topics.html">10. 発展的なトピック</a></li>
        </ul>
    </nav>
    <div class="container">
    <h1>7. グラフ作成の応用</h1>

    <p>このセクションでは、グラフ作成の応用的なトピックを扱います。高度なggplot2機能、適切なグラフタイプの選択方法、そしてインタラクティブなグラフ作成について学びます。</p>

    <h2>7.1 高度なggplot2機能</h2>

    <p>ggplot2には、より複雑で情報量の多いグラフを作成するための高度な機能があります。ここでは、ファセットとテーマのカスタマイズを中心に紹介します。</p>

    <h3>7.1.1 ファセット（Faceting）</h3>
    <p>ファセットを使用すると、データのサブセットごとに別々のプロットを作成できます。</p>

    <pre><code># サンプルデータの作成
data <- data.frame(
  species = rep(c("Species A", "Species B", "Species C"), each = 30),
  treatment = rep(rep(c("Control", "Treatment 1", "Treatment 2"), each = 10), 3),
  response = rnorm(90, mean = 10, sd = 2)
)

# ファセットを使用したプロット
ggplot(data, aes(x = treatment, y = response, fill = treatment)) +
  geom_boxplot() +
  facet_wrap(~ species, ncol = 3) +
  labs(title = "種ごとの処理に対する反応",
       x = "処理", y = "反応") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
</code></pre>

    <h3>7.1.2 テーマのカスタマイズ</h3>
    <p>ggplot2のテーマを調整することで、グラフの見た目を細かく制御できます。</p>

    <pre><code># カスタムテーマの作成
my_theme <- theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    axis.title = element_text(size = 12, face = "bold"),
    axis.text = element_text(size = 10),
    legend.position = "bottom",
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_blank()
  )

# カスタムテーマを適用したプロット
ggplot(data, aes(x = treatment, y = response, fill = species)) +
  geom_boxplot() +
  labs(title = "処理に対する種ごとの反応",
       x = "処理", y = "反応") +
  scale_fill_brewer(palette = "Set2") +
  my_theme
</code></pre>

    <h3>7.1.3 複合的なグラフ</h3>
    <p>異なるタイプのグラフ要素を組み合わせることで、より情報量の多いグラフを作成できます。</p>

    <pre><code># 複合的なグラフの作成
ggplot(data, aes(x = treatment, y = response, fill = species)) +
  geom_boxplot(alpha = 0.7) +
  geom_jitter(width = 0.2, alpha = 0.5) +
  stat_summary(fun = mean, geom = "point", shape = 18, size = 3, color = "red") +
  facet_wrap(~ species, ncol = 3) +
  labs(title = "種ごとの処理に対する反応（個別データ点と平均値）",
       x = "処理", y = "反応") +
  scale_fill_brewer(palette = "Set2") +
  my_theme
</code></pre>

    <h2>7.2 グラフタイプの選択ガイドライン</h2>

    <p>適切なグラフタイプを選択することは、データを効果的に伝えるために重要です。以下に、よく使用されるグラフタイプの適切な使用場面と注意点を説明します。</p>

    <h3>7.2.1 散布図</h3>
    <p><strong>使用場面：</strong> 2つの連続変数間の関係を表示する場合（例：体重と身長の関係）</p>
    <p><strong>注意点：</strong></p>
    <ul>
        <li>データ点が多すぎる場合、重なりを避けるために透明度を調整するか、2次元密度プロットを検討する</li>
        <li>外れ値に注意し、必要に応じて別途分析する</li>
    </ul>

    <h3>7.2.2 線グラフ</h3>
    <p><strong>使用場面：</strong> 時系列データや連続的な変化を示す場合（例：遺伝子発現の時間変化）</p>
    <p><strong>注意点：</strong></p>
    <ul>
        <li>データ点間の補間が適切かどうか考慮する</li>
        <li>Y軸を0から開始するかどうかを慎重に決定する</li>
    </ul>

    <h3>7.2.3 棒グラフ</h3>
    <p><strong>使用場面：</strong> カテゴリ間の比較や頻度を表示する場合（例：異なる処理群間の平均値の比較）</p>
    <p><strong>注意点：</strong></p>
    <ul>
        <li>Y軸は通常0から開始する</li>
        <li>エラーバーを追加して変動を示すことが重要</li>
    </ul>

    <h3>7.2.4 箱ひげ図</h3>
    <p><strong>使用場面：</strong> データの分布や複数のグループ間の比較を行う場合（例：異なる種間での体重分布の比較）</p>
    <p><strong>注意点：</strong></p>
    <ul>
        <li>外れ値の表示方法に注意する</li>
        <li>サンプルサイズが小さい場合、個々のデータ点も表示することを検討する</li>
    </ul>

    <h2>7.3 インタラクティブなグラフ作成（plotly）</h2>

    <p>plotlyは、インタラクティブで動的なグラフを作成するためのパッケージです。ユーザーがグラフ上でズームインやホバーなどの操作を行えるため、データの詳細な探索が可能になります。</p>

    <h3>7.3.1 plotlyのインストールと基本使用法</h3>
    <pre><code># plotlyのインストール
install.packages("plotly")

# ライブラリの読み込み
library(plotly)
library(ggplot2)  # ggplot2と組み合わせて使用することが多い
</code></pre>

    <h3>7.3.2 散布図の例</h3>
    <pre><code># サンプルデータの作成
data <- data.frame(
  x = rnorm(100),
  y = rnorm(100),
  group = sample(c("A", "B"), 100, replace = TRUE)
)

# ggplot2でグラフを作成し、plotlyで変換
p <- ggplot(data, aes(x = x, y = y, color = group)) +
  geom_point() +
  labs(title = "インタラクティブ散布図")

# plotlyオブジェクトに変換
plotly_graph <- ggplotly(p)

# グラフの表示（RStudioのビューアで表示されます）
plotly_graph
</code></pre>

    <h3>7.3.3 時系列データの可視化</h3>
    <pre><code># 遺伝子発現データの読み込み（前の例で使用したCSVファイル）
gene_data <- read.csv("gene_expression_dataset.csv")

# Gene1のデータのみを抽出
gene1_data <- gene_data[gene_data$gene == "Gene1", ]

# plotlyで直接グラフを作成
plot_ly(gene1_data, x = ~time_point, y = ~expression_level, color = ~condition, type = "scatter", mode = "lines+markers") %>%
  layout(title = "Gene1の発現レベル時間変化",
         xaxis = list(title = "時間 (時間)"),
         yaxis = list(title = "発現レベル"))
</code></pre>

    <div class="note">
    <p><strong>注意：</strong> plotlyで作成したグラフは、HTML形式で保存してウェブブラウザで表示したり、Rmarkdownドキュメントに埋め込んだりすることができます。これにより、インタラクティブな要素を含むレポートや発表資料を作成できます。</p>
    </div>

    <p>これらの応用的なグラフ作成技術を習得することで、より効果的にデータを可視化し、複雑な関係性や傾向を明確に伝えることができます。適切なグラフタイプの選択と、インタラクティブな要素の追加により、データの理解と探索がより深まります。</p>
    <section id="7-exercises">
        <h2>練習問題へ</h2>
        <p>練習問題が用意されています。自分のペースで学習を進めてください。</p>
        <a href="7-advanced-graph-creation-exercises.html" class="cta-button">練習問題を始める</a>
    </section>
</div>
</body>
</html>
